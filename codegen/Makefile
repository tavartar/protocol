# ~/mtv/protocol/codegen/Makefile

SWIFT_GEN=generate_swift.swift
PY_GEN=generate_py.py
JS_GEN=generate_js.js
TS_GEN=generate_ts.js
TS_GEN_V1=generate_ts.js.v1.0
KOTLIN_GEN=generate_kotlin.main.kts

.PHONY: all swift python js ts ts_v1 kotlin rust clean

all: swift python js ts kotlin rust

swift:
	@echo "â–¶ï¸  Generating Swift..."
	@swift $(SWIFT_GEN)

python:
	@echo "ðŸ Generating Python..."
	@python3 $(PY_GEN)

js:
	@echo "ðŸŸ¨ Generating JavaScript..."
	@node $(JS_GEN)

ts:
	@echo "ðŸŸ¦ Generating TypeScript (latest)..."
	@node $(TS_GEN)

ts_v1:
	@echo "ðŸŸ¦ Generating TypeScript v1.0..."
	@node $(TS_GEN_V1)

kotlin:
	@echo "ðŸ§¬ Generating Kotlin..."
	@kotlinc -script $(KOTLIN_GEN)

rust:
	@echo "ðŸ¦€ Building Rust codegen..."
	@cd rust_codegen && cargo build --release

go:
	@echo "ðŸ¹ Generating Go code..."
	@if [ -f generate_go.go ]; then go run generate_go.go $(PROTOCOL_JSON) $(OUT_DIR)/go; else echo "âš ï¸  Skipping Go: generate_go.go not found."; fi


clean:
	@echo "ðŸ§¹ Cleaning Rust build..."
	@cd rust_codegen && cargo clean

port:
	mkdir -p ~/mtv/karaoke-app/protocol/
	cp -r ../out/python  ~/mtv/karaoke-app/protocol/ 2>/dev/null || true
	cp -r ../out/swift   ~/mtv/karaoke-app/protocol/ 2>/dev/null || true
	cp -r ../out/kotlin  ~/mtv/karaoke-app/protocol/ 2>/dev/null || true
	cp -r ../out/ts      ~/mtv/karaoke-app/protocol/ 2>/dev/null || true
	cp -r ../out/go      ~/mtv/karaoke-app/protocol/ 2>/dev/null || true
	cp -r ../out/rust    ~/mtv/karaoke-app/protocol/ 2>/dev/null || true

