# Makefile for language-specific protocol code generation with existence checks

PYTHON         := python3
PROTOCOL_JSON  := ../protocol.json
OUT_DIR        := ../out
APP_PROTOCOL   := ~/mtv/karaoke-app/protocol/

.PHONY: python swift kotlin ts rust port clean

python:
	$(PYTHON) generate_py.py $(PROTOCOL_JSON) $(OUT_DIR)/python

swift:
	@echo "ðŸŒ€ Generating Swift protocol code..."
	@if [ -f generate_swift ]; then ./generate_swift $(PROTOCOL_JSON) $(OUT_DIR)/swift; else echo "âš ï¸  Skipping Swift: generate_swift not found."; fi

kotlin:
	@echo "ðŸŒ€ Generating Kotlin protocol code..."
	@if [ -f generate_kotlin ]; then ./generate_kotlin $(PROTOCOL_JSON) $(OUT_DIR)/kotlin; else echo "âš ï¸  Skipping Kotlin: generate_kotlin not found."; fi

ts:
	@echo "ðŸŒ€ Generating TypeScript protocol code..."
	@if [ -f generate_ts ]; then ./generate_ts $(PROTOCOL_JSON) $(OUT_DIR)/ts; else echo "âš ï¸  Skipping TypeScript: generate_ts not found."; fi

rust:
	@echo "ðŸŒ€ Generating Rust protocol code..."
	@if [ -f generate_rust ]; then ./generate_rust $(PROTOCOL_JSON) $(OUT_DIR)/rust; else echo "âš ï¸  Skipping Rust: generate_rust not found."; fi

port:
	@echo "ðŸšš Porting generated models to karaoke-app..."
	mkdir -p $(APP_PROTOCOL)
	cp -r $(OUT_DIR)/python  $(APP_PROTOCOL) 2>/dev/null || true
	cp -r $(OUT_DIR)/swift   $(APP_PROTOCOL) 2>/dev/null || true
	cp -r $(OUT_DIR)/kotlin  $(APP_PROTOCOL) 2>/dev/null || true
	cp -r $(OUT_DIR)/ts      $(APP_PROTOCOL) 2>/dev/null || true
	cp -r $(OUT_DIR)/rust    $(APP_PROTOCOL) 2>/dev/null || true

clean:
	@echo "ðŸ§¼ Cleaning output directory..."
	rm -rf $(OUT_DIR)/*

